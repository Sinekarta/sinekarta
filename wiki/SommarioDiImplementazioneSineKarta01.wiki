#summary 19/09/14 - Sommario di implementazione SineKarta

= Introduzione =

Nel corso dello sviluppo per la delivery odierna, vedi SinekartaDsRoadmap2, è stata implementata la firma PDF e si è presentato il problema della sua integrazione nel sistema attuale, questo ha portato ad un lavoro di refactoring nell'architettura del progetto.
Seguono alcuni esempi delle problematiche che hanno portato a rivedere l'implementazione:
  * le classi di dominio inizialmente sviluppate per la validazione della firma CMS potevano esser ora adattate alla gestione degli altri tipi di firma per limitare la ridondanze del codice
  * l'aggiornamento del model ha portato alla luce che diversi moduli del progetto potevano quindi esser riorganizzati semplificati per ottenere un unico protocollo generale di firma e verifica, pilotato dalle classi stesse di dominio
  * da una maggior comprensione delle firme CMS e PDF è emerso un modo più corretto per gestire l'applicazione e la verifica delle marche temporali
  * i processi di verifica finora implementati erano incompleti in quanto garantivano l'integrità delle firme, non l'attendibilità del firmatario
  * durante la ristrutturazione del model, non era completamente come sarebbe dovuta esser gestita la catena di certificazione nei service di firma e verifica per consentire (e non si può più rischiare di investire altro tempo in ulteriori ristrutturazioni)
Il pesante refactoring che ne è seguito ha portato alla luce la necessità di un'ultima analisi generale del lavoro svolto, al fine di stabilizzare le interfacce dei moduli di modo che non emerga più la necessità di metterci mano, nemmeno negli sviluppi futuri.


= Model = 
  * DigestInfo: impronta ed algoritmo usato
  * SignatureType: tipi di firma supportati
  * SignatureDisposition: posizioni in cui è possibile inserire la firma 
  * CertificateInfo: estensione di X509Certificate recante le informazioni di validazione, si veda di seguito
  * CertificationSource: protocollo di reperimento di certificati verificati
  * SignatureInfo: firma digitale, algoritmo usato, certificato ed accesso alla relativa catena, dettagli della firma, altri attributi
    * CMSSignatureInfo
    * PDFSignatureInfo: estensione per la firma PDF
    * XMLSignatureInfo: estensione per la firma XML
    * TimeStampInfo: estensione per i timestamp, output per la verifica della marca
  * TsRequestInfo: input per le richieste ai servizi di marca temporale
  * VerifyInfo: output delle validazioni per ogni firma o marca


= Architettura del core =

  * SignatureService: unico protocollo di firma, verifica e marca, tutte le informazioni specifiche per il tipo di firma verranno indicate dal relativo DTO
    * CMSSignatureService 
    * PDFSignatureService 
    * XMLSignatureService

= Architettura di certificazione =
  * CertificateInfoComparator: supporta diversi ordinamenti per i certificati (es alfabetico, attendibilità per verifica, si veda di seguito
  * AbstractCertificationSource: implementazione di CertificationSource, generico fornitore dei certificati presenti in una qualunque fonte
    * TrustedKeyStore unità di immagazzinamento dei certificati, può esser usata per contenere quelli presenti in altri supporti (es. accedere ai (soli) certificati nelle smartcard anche quando queste non sono fisicamente disponibili)
      * FileSystemKeyStore: solo per amministratore sinekarta
      * AlfrescoKeyStore: per qualsiasi utente autenticato
    * FakeCertificationSource base comune per le fonti non implementati ma il cui supporto è previsto dall'architettura
      * JavaKeytool: CA universamente accettate dalla JVM
      * SmartCardReader
      * USBToken
      * Webservice (?? vedere se necessario durante lo sviluppo della firma da WS)
  * CertificateChainBuilder: verifica dei certificati, generazione delle catene di certificazione
  * CertificationTree: struttura ad albero il mantenimento delle relazioni di firma tra i certificati
  * CertificationRepository: unità centrale di immagazzinamento dei certificati e controllo delle altre fonti, singleton
  * X509Provider: utility suite per la conversione e la verifica dei certificati


= Conclusioni = 
